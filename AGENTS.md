# Правила и решения проекта pkgm

## Основные принципы

1. **Поддержка переменной окружения PKGM_PREFIX**: Проект должен поддерживать возможность задания пользовательской директории установки через переменную окружения `PKGM_PREFIX`.

2. **Совместимость существующим поведением**: При отсутствии переменной `PKGM_PREFIX`, проект должен использовать прежнее поведение - установку в `/usr/local`.

3. **Установка с правами суперпользователя**: Использование `sudo` по-прежнему предполагает установку в директорию по умолчанию, но теперь может быть переопределено через `PKGM_PREFIX`.

## Технические решения

1. **Функция `install_prefix()`**: Основная логика определения директории установки теперь учитывает переменную окружения `PKGM_PREFIX`, если она установлена.

2. **Обновление всех ссылок на `/usr/local`**: Все жестко закодированные пути к `/usr/local` были заменены на динамическое определение с использованием переменной `PKGM_PREFIX` или значения по умолчанию.

3. **Поддержка вспомогательных функций**: Все функции, которые используют пути к установке, были обновлены для поддержки переменной `PKGM_PREFIX`.

## Документирование изменений

1. **README.md**: Документация была обновлена для отражения новой функциональности и примеров использования переменной `PKGM_PREFIX`.

2. **Обратная совместимость**: Все изменения обеспечивают полную обратную совместимость с существующими сценариями использования.

## Тестирование

1. **Локальная установка**: Убедиться, что установка без `sudo` продолжает работать в `~/.local`.

2. **Установка с PKGM_PREFIX**: Проверить, что установка с переменной `PKGM_PREFIX` корректно использует указанную директорию.

3. **Установка с sudo**: Убедиться, что установка с `sudo` работает как раньше, но учитывает `PKGM_PREFIX` при его наличии.